// Autogenerated from templates.
requires "x86-configuration.k"
requires "x86-flag-checks-syntax.k"

/*@ This file defines the semantics of following 51 base instructions.
  - popcntq_r64_r64,
*/

module POPCNT-R64-R64
  imports X86-CONFIGURATION
  imports X86-FLAG-CHECKS-SYNTAX

  // Unroll START
  rule <k> 
    execinstr (popcntq , (%rax ,  (%rax , .Typedoperands)) ) =>
      execinstr(popcntq, (%rax, popCount(MI), .Typedoperands)) 
  ...</k>
  <rax> MI </rax>
  rule <k> 
    execinstr (popcntq , (%rbx ,  (%rax , .Typedoperands)) ) =>
      execinstr(popcntq, (%rax, popCount(MI), .Typedoperands)) 
  ...</k>
  <rbx> MI </rbx>
  rule <k> 
    execinstr (popcntq , (%rcx ,  (%rax , .Typedoperands)) ) =>
      execinstr(popcntq, (%rax, popCount(MI), .Typedoperands)) 
  ...</k>
  <rcx> MI </rcx>
  rule <k> 
    execinstr (popcntq , (%rax ,  (%rbx , .Typedoperands)) ) =>
      execinstr(popcntq, (%rbx, popCount(MI), .Typedoperands)) 
  ...</k>
  <rax> MI </rax>
  rule <k> 
    execinstr (popcntq , (%rbx ,  (%rbx , .Typedoperands)) ) =>
      execinstr(popcntq, (%rbx, popCount(MI), .Typedoperands)) 
  ...</k>
  <rbx> MI </rbx>
  rule <k> 
    execinstr (popcntq , (%rcx ,  (%rbx , .Typedoperands)) ) =>
      execinstr(popcntq, (%rbx, popCount(MI), .Typedoperands)) 
  ...</k>
  <rcx> MI </rcx>
  rule <k> 
    execinstr (popcntq , (%rax ,  (%rcx , .Typedoperands)) ) =>
      execinstr(popcntq, (%rcx, popCount(MI), .Typedoperands)) 
  ...</k>
  <rax> MI </rax>
  rule <k> 
    execinstr (popcntq , (%rbx ,  (%rcx , .Typedoperands)) ) =>
      execinstr(popcntq, (%rcx, popCount(MI), .Typedoperands)) 
  ...</k>
  <rbx> MI </rbx>
  rule <k> 
    execinstr (popcntq , (%rcx ,  (%rcx , .Typedoperands)) ) =>
      execinstr(popcntq, (%rcx, popCount(MI), .Typedoperands)) 
  ...</k>
  <rcx> MI </rcx>
  // Unroll END

  rule
    execinstr(popcntq, ( DestR:R64, MIsrc:MInt, .Typedoperands )) => 
    setOverflow(zeroMIntW1) ~>
    setZeroFlag(zeroMIntW1) ~>
    setSignFlag(zeroMIntW1) ~>
    setAuxCarryFlag(zeroMIntW1) ~>
    setCarryFlag(zeroMIntW1) ~>
    setParityFlag(zeroMIntW1) ~>
    updateReg(MIsrc, DestR) 
      requires notBool zeroMInt(MIsrc)

  rule
    execinstr(popcntq, ( DestR:R64, MIsrc:MInt, .Typedoperands )) => 
    setOverflow(zeroMIntW1) ~>
    setZeroFlag(oneMIntW1) ~>
    setSignFlag(zeroMIntW1) ~>
    setAuxCarryFlag(zeroMIntW1) ~>
    setCarryFlag(zeroMIntW1) ~>
    setParityFlag(zeroMIntW1) ~>
    updateReg(MIsrc, DestR) 
      requires zeroMInt(MIsrc)

endmodule

module POPCNT-SEMANTICS
  imports POPCNT-R64-R64
endmodule
