// Autogenerated from templates.
requires "x86-semantic-utils.k"

/*@ This file defines the semantics of following 51 base instructions.
  - popcntq_r64_r64,
*/

module POPCNT-R64-R64
  imports X86-SEMANTIC-UTILS

  // Unroll START
Unroll START PATTERN-6
  rule <k> 
    execinstr (popcntq , (%REG64_1 ,  (%REG64_2 , .Typedoperands)) ) =>
      execinstr(popcntq, (%REG64_2, popCount(MI, 64), .Typedoperands)) 
  ...</k>
  <REG64_1> MI </REG64_1>
Unroll END
  // Unroll END

  rule
    execinstr(popcntq, ( DestR:R64, MIsrc:MInt, .Typedoperands )) => 
    setOverflow(mi(1,0)) ~>
    setZeroFlag(mi(1,0)) ~>
    setSignFlag(mi(1,0)) ~>
    setAuxCarryFlag(mi(1,0)) ~>
    setCarryFlag(mi(1,0)) ~>
    setParityFlag(mi(1,0)) ~>
    updateReg(MIsrc, DestR) 
      requires notBool zeroMInt(MIsrc)

  rule
    execinstr(popcntq, ( DestR:R64, MIsrc:MInt, .Typedoperands )) => 
    setOverflow(mi(1,0)) ~>
    setZeroFlag(mi(1,1)) ~>
    setSignFlag(mi(1,0)) ~>
    setAuxCarryFlag(mi(1,0)) ~>
    setCarryFlag(mi(1,0)) ~>
    setParityFlag(mi(1,0)) ~>
    updateReg(MIsrc, DestR) 
      requires zeroMInt(MIsrc)

endmodule

module POPCNT-SEMANTICS
  imports POPCNT-R64-R64
endmodule
