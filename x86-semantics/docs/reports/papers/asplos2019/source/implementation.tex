\section{Implementation}

\subsection{Porting Formulas for stratified instructions to \K Rules}

For the purpose, we could have directly converted the \Strata formulas
to \K rule assuming that the \Strata's symbolic execution over the 
stratified instruction sequence is correct.

Given that fact the \K's symbolic execution engine is more trusted as 
that has been used extensively in language-agnostic manner to perform symbolic
execution, we decided to use ... 

\begin{itemize}
\item Implementing the base instructions semantics in \K and testing them.
\item Symbolic execution of the stratified instruction sequences.
\item Dealing with scratch pad registers.
\item Simplification of formulas.
  Simplification generates simpler \K rule (than the corresponding \Strata formula)
  in some cases. 
\item Check the the ported \K rules are equivalent to the strata formulas to
begin with. This helped us in finding a bug in \Strata's symbolic execution 
engine which is anyway fixed by the authors in their recent versions.

\end{itemize}

\subsection{Supporting un-stratified instructions \& Porting their formulas to \K Rules}

\subsubsection{Supporting un-stratified instructions}
\paragraph{Instruction support status}

\begin{figure*}[t]
\centering
\fig{figures/instruction_classification}
\caption{Instruction classification\label{fig:instr_class}}
\end{figure*}

\subsection{Porting to \K Rules}

\Strata could output the internal AST, used to model a register state formula, in different
formats. Supported backend are SmtLib and Prefix notation. We have added another backend 
to generate \K rule. We need some way to validate the backend. 

\paragraph{Validate the Backend}

The \K rules generated using the backend are matched (syntactically)  against
the ones we already obtained via symbolic execution on stratified instructions.
This has an added benefit that in order to get the exact match, we need to port
all the simplification rules from \K to strata code, which in turn will later
help in generating simplified \K rules for non-stratified instructions. 

Main challenges in getting an exact match are:
\begin{itemize}

\item  \Strata rules uses \extract to extract portion of a bit-vector. The high
and low indices of \extract are obtained considering LSB at index 0, whereas \K
uses \extractMInt for the same purpose, but uses MSB at index zero.

\item  \Strata uses flags as \bool, whereas they are treated as \bv in our
semantics. We modifed strata so as to treat flag registers as 1 bit bitvectors.

\end{itemize}


